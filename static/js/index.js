const icon24 =
  '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><path d="M90,91h-4v-8c0-1.1-0.9-2-2-2h-5.5c4.7-6.1,7.5-13.7,7.5-22c0-19.9-16.2-36-36-36S14,39.1,14,59c0,8.3,2.8,15.9,7.5,22H16  c-1.1,0-2,0.9-2,2v8h-4c-1.1,0-2,0.9-2,2c0,1.1,0.9,2,2,2h80c1.1,0,2-0.9,2-2C92,91.9,91.1,91,90,91z M18,59c0-17.7,14.3-32,32-32  c17.6,0,32,14.3,32,32c0,8.5-3.3,16.3-8.8,22H26.8C21.4,75.3,18,67.5,18,59z M82,91H18v-6h64V91z M26,61c-1.1,0-2-0.9-2-2  c0-14.3,11.7-26,26-26c1.1,0,2,0.9,2,2c0,1.1-0.9,2-2,2c-12.1,0-22,9.9-22,22C28,60.1,27.1,61,26,61z M48,15V7c0-1.1,0.9-2,2-2  s2,0.9,2,2v8c0,1.1-0.9,2-2,2S48,16.1,48,15z M77,22l4.8-6.4c0.7-0.9,1.9-1.1,2.8-0.4c0.9,0.7,1.1,1.9,0.4,2.8l-4.8,6.4  c-0.4,0.5-1,0.8-1.6,0.8c-0.4,0-0.8-0.1-1.2-0.4C76.5,24.1,76.3,22.9,77,22z M15,18c-0.7-0.9-0.5-2.1,0.4-2.8s2.1-0.5,2.8,0.4L23,22  c0.7,0.9,0.5,2.1-0.4,2.8c-0.4,0.3-0.8,0.4-1.2,0.4c-0.6,0-1.2-0.3-1.6-0.8L15,18z"/></svg>'
const icon48 =
  '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><path d="M90,91h-4v-8c0-1.1-0.9-2-2-2h-5.5c4.7-6.1,7.5-13.7,7.5-22c0-19.9-16.2-36-36-36S14,39.1,14,59c0,8.3,2.8,15.9,7.5,22H16  c-1.1,0-2,0.9-2,2v8h-4c-1.1,0-2,0.9-2,2c0,1.1,0.9,2,2,2h80c1.1,0,2-0.9,2-2C92,91.9,91.1,91,90,91z M18,59c0-17.7,14.3-32,32-32  c17.6,0,32,14.3,32,32c0,8.5-3.3,16.3-8.8,22H26.8C21.4,75.3,18,67.5,18,59z M82,91H18v-6h64V91z M26,61c-1.1,0-2-0.9-2-2  c0-14.3,11.7-26,26-26c1.1,0,2,0.9,2,2c0,1.1-0.9,2-2,2c-12.1,0-22,9.9-22,22C28,60.1,27.1,61,26,61z M48,15V7c0-1.1,0.9-2,2-2  s2,0.9,2,2v8c0,1.1-0.9,2-2,2S48,16.1,48,15z M77,22l4.8-6.4c0.7-0.9,1.9-1.1,2.8-0.4c0.9,0.7,1.1,1.9,0.4,2.8l-4.8,6.4  c-0.4,0.5-1,0.8-1.6,0.8c-0.4,0-0.8-0.1-1.2-0.4C76.5,24.1,76.3,22.9,77,22z M15,18c-0.7-0.9-0.5-2.1,0.4-2.8s2.1-0.5,2.8,0.4L23,22  c0.7,0.9,0.5,2.1-0.4,2.8c-0.4,0.3-0.8,0.4-1.2,0.4c-0.6,0-1.2-0.3-1.6-0.8L15,18z"/></svg>'

const randomizeIcon = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" version="1.1" style="shape-rendering:geometricPrecision;text-rendering:geometricPrecision;image-rendering:optimizeQuality;" viewBox="0 0 290 276.25" x="0px" y="0px" fill-rule="evenodd" clip-rule="evenodd"><defs><style type="text/css">.fil1 {fill:black}.fil0 {fill:black}.fil2 {fill:black;fill-rule:nonzero}.fil3 {fill:black;fill-rule:nonzero}</style></defs><g><path class="fil0" d="M239 128l-36 79c-1,3 -4,5 -8,6l-86 8c-4,0 -7,-2 -9,-5l-50 -70c-2,-3 -3,-7 -1,-10l36 -79c1,-3 4,-5 8,-6l86 -8c4,0 7,2 9,5l50 70c2,3 3,7 1,10zm-88 5l44 61 31 -70 -43 -61 -32 70zm32 67l-42 -59 -74 6 42 60 74 -7zm-119 -66l75 -7 32 -70 -75 7 -32 70z"/><circle class="fil1" transform="matrix(-0.679454 -0.291506 0.0431206 -0.970878 188.241 152.271)" r="14"/><circle class="fil1" transform="matrix(-0.650079 -0.282659 0.0709672 -0.941413 188.329 98.6349)" r="14"/><circle class="fil1" transform="matrix(0.692194 0.43966 -0.474723 0.381588 132.739 156.333)" r="14"/><circle class="fil1" transform="matrix(0.692194 0.43966 -0.474723 0.381588 95.0486 160.393)" r="14"/><circle class="fil1" transform="matrix(0.692194 0.43966 -0.474723 0.381588 153.612 186.193)" r="14"/><circle class="fil1" transform="matrix(0.692194 0.43966 -0.474723 0.381588 115.921 190.253)" r="14"/><circle class="fil1" transform="matrix(-0.934798 0.282659 -0.110515 0.941413 114.827 96.8952)" r="14"/><path class="fil2" d="M54 43c7,-15 20,-23 35,-25l2 6c-14,2 -25,9 -31,22l-6 -3z"/><path class="fil3" d="M23 170c-9,-13 -11,-28 -6,-43l7 2c-4,13 -4,26 5,37l-6 4z"/><path class="fil2" d="M181 13c15,1 25,7 34,20l-6 4c-6,-11 -17,-17 -29,-17l1 -7z"/><path class="fil2" d="M270 105c7,15 6,30 -2,44l-6 -3c7,-12 8,-25 2,-38l6 -3z"/><path class="fil2" d="M46 31c7,-15 19,-23 35,-25l1 6c-13,2 -24,9 -30,22l-6 -3z"/><path class="fil3" d="M9 172c-10,-13 -11,-28 -6,-43l6 2c-4,13 -3,26 5,37l-5 4z"/><path class="fil2" d="M183 0c16,0 29,7 38,20l-5 4c-8,-11 -19,-18 -33,-17l0 -7z"/><path class="fil2" d="M285 106c7,15 5,30 -2,44l-6 -3c7,-12 8,-25 2,-38l6 -3z"/></g></svg>'


function run() {
  miro.initialize({
    extensionPoints: {
      toolbar: {
        title: 'Thing of the future',
        toolbarSvgIcon: icon24,
        librarySvgIcon: icon48,
        onClick: () => {
          miro.board.ui.openLibrary('builder', {
            title: 'Thing of the future',
          })
        },
      },
      getWidgetMenuItems: function (selectedWidgets) {
        const firstWidget = selectedWidgets[0]
        if (firstWidget.type === 'SHAPE') {
          return [
            {
              tooltip: 'Randomize',
              svgIcon: randomizeIcon,
              onClick: () => {
                const getRandom = (array) => {
                  return array[Math.floor(Math.random() * array.length)]
                }

                console.log(firstWidget)
                if (firstWidget.metadata[APP_ID].type) {
                  const type = firstWidget.metadata[APP_ID].type
                  let text
                  if (type === 'arc') {
                    text = `<div></br></br></br><h1>${getRandom(
                      cards.arc.subtypes
                    ).toUpperCase()}</h1></br></br><h2>${getRandom(
                      cards.arc.values
                    ).toUpperCase()}</h2></div>`

                    firstWidget['text'] = text
                  } else if (type === 'terrain') {
                    text = `<div><h1>${getRandom(
                      cards.terrain.values
                    ).toUpperCase()}</h1></div>`
                    firstWidget['text'] = text
                  } else if (type === 'object') {
                    text = `<div><h1>${getRandom(
                      cards.object.values
                    ).toUpperCase()}</h1></div>`
                    firstWidget['text'] = text
                  } else if (type === 'mood') {
                    text = `<div><h1>${getRandom(
                      cards.mood.values
                    ).toUpperCase()}</h1></div>`
                    firstWidget['text'] = text
                  }

                  miro.board.widgets.update([firstWidget])
                }
                miro.showNotification('You clicked a widget menu item!')
              },
            },
          ]
        }
      },
    },
  })
}

miro.onReady(run)
